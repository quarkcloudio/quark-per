!function(){"use strict";function t(t){return function(e){return n=typeof(r=e),(null===r?"null":"object"==n&&(Array.prototype.isPrototypeOf(r)||r.constructor&&"Array"===r.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(r)||r.constructor&&"String"===r.constructor.name)?"string":n)===t;var r,n}}function e(t){return t.getParam("importcss_selector_converter")}function r(t){return s(t)?function(e){return-1!==e.indexOf(t)}:t instanceof RegExp?function(e){return t.test(e)}:t}function n(t,e){var r,n=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(e);if(n){var o=n[1],i=n[2].substr(1).split(".").join(" "),c=m.makeMap("a,img");return n[1]?(r={title:e},t.schema.getTextBlockElements()[o]?r.block=o:t.schema.getBlockElements()[o]||c[o.toLowerCase()]?r.selector=o:r.inline=o):n[2]&&(r={inline:"span",title:e.substr(1),classes:i}),!1!==t.getParam("importcss_merge_classes")?r.classes=i:r.attributes={class:i},r}}function o(t,e){return null===e||!1!==t.getParam("importcss_exclusive")}function i(t){t.on("init",(function(){function i(r,i){if(y=r,d=_,!(o(t,h=i)?y in d:y in h.selectors)){p=r,v=_,o(t,g=i)?v[p]=!0:g.selectors[p]=!0;var c=(l=(a=t).plugins.importcss,f=r,((m=i)&&m.selector_converter?m.selector_converter:e(a)?e(a):function(){return n(a,f)}).call(l,f,m));if(c){var s=c.name||u.DOM.uniqueId();return t.formatter.register(s,c),{title:c.title,format:s}}}var a,l,f,m,p,g,v,y,h,d;return null}var c,v,y,h,d=(c=[],v=[],y={},{addItemToGroup:function(t,e){y[t]?y[t].push(e):(v.push(t),y[t]=[e])},addItem:function(t){c.push(t)},toFormats:function(){return function(t){for(var e=[],r=0,n=t.length;r<n;++r){if(!a(t[r]))throw new Error("Arr.flatten item "+r+" was not an array, input: "+t);p.apply(e,t[r])}return e}(function(t,e){for(var r=t.length,n=new Array(r),o=0;o<r;o++){var i=t[o];n[o]=e(i,o)}return n}(v,(function(t){var e=y[t];return 0===e.length?[]:[{title:t,items:e}]}))).concat(c)}}),_={},x=r(t.getParam("importcss_selector_filter")),P=(h=t.getParam("importcss_groups"),m.map(h,(function(t){return m.extend({},t,{original:t,selectors:{},filter:r(t.filter)})})));m.each(function(t,e,r){var n=[],o={},i=function(e,o){var c,a,u=a=e.href,p=f.cacheSuffix;if((a=u=s(u)?u.replace("?"+p,"").replace("&"+p,""):u)&&r(a,o)&&!function(t,e){var r,n=!1!==(r=t.getParam("skin"))&&(r||"oxide");if(n){var o=t.getParam("skin_url"),i=o?t.documentBaseURI.toAbsolute(o):l.baseURL+"/skins/ui/"+n,c=l.baseURL+"/skins/content/";return e===i+"/content"+(t.inline?".inline":"")+".min.css"||-1!==e.indexOf(c)}}(t,a)){m.each(e.imports,(function(t){i(t,!0)}));try{c=e.cssRules||e.rules}catch(e){}m.each(c,(function(t){t.styleSheet?i(t.styleSheet,!0):t.selectorText&&m.each(t.selectorText.split(","),(function(t){n.push(m.trim(t))}))}))}};m.each(t.contentCSS,(function(t){o[t]=!0})),r=r||function(t,e){return e||o[t]};try{m.each(e.styleSheets,(function(t){i(t)}))}catch(e){}return n}(t,t.getDoc(),r(t.getParam("importcss_file_filter"))),(function(t){var e,r,n;g.test(t)||x&&!x(t)||(n=t,0<(e=m.grep(P,(function(t){return!t.filter||t.filter(n)}))).length?m.each(e,(function(e){var r=i(t,e);r&&d.addItemToGroup(e.title,r)})):(r=i(t,null))&&d.addItem(r))}));var T=d.toFormats();t.fire("addStyleModifications",{items:T,replace:!t.getParam("importcss_append")})}))}var c=tinymce.util.Tools.resolve("tinymce.PluginManager"),s=t("string"),a=t("array"),u=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),l=tinymce.util.Tools.resolve("tinymce.EditorManager"),f=tinymce.util.Tools.resolve("tinymce.Env"),m=tinymce.util.Tools.resolve("tinymce.util.Tools"),p=Array.prototype.push,g=/^\.(?:ephox|tiny-pageembed|mce)(?:[.-]+\w+)+$/;c.add("importcss",(function(t){return i(t),e=t,{convertSelectorToFormat:function(t){return n(e,t)}};var e}))}();